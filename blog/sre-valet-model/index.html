<!DOCTYPE html>
<html lang="zh">

  <head>
  <meta charset="utf-8">
  <meta name="robots" content="all,follow">
  <meta name="googlebot" content="index,follow,snippet,archive">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <title>SRE落地：用VALET模式统一语言</title>
  <meta name="author" content="持续交付2.0" />
  
  
  
  
  <meta name="keywords" content="devops, 持续交付, 轻敏捷, 双环模型, 敏捷方法, 敏捷开发, 精益思想, Scrum, 用户故事, DevOps, SRE, google, 智能运维, AIOps">
  
  
  <meta name="description" content="持续交付2.0 爱好者网站，本网站讨论持续交付，DevOps，敏捷开发，精益思想，Scrum，敏捷方法，用户故事">

  <meta name="generator" content="Hugo 0.74.2" />

  
  <link href='//fonts.googleapis.com/css?family=Roboto:400,100,100italic,300,300italic,500,700,800' rel='stylesheet' type='text/css'>

  
  <link rel="stylesheet" href="//use.fontawesome.com/releases/v5.11.2/css/all.css">
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

  
  <link href="/css/animate.css" rel="stylesheet">

  
  
    <link href="/css/style.violet.css" rel="stylesheet" id="theme-stylesheet">
  

  
  <link href="/css/custom.css" rel="stylesheet">

  
  
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
        <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  

  
  <link rel="shortcut icon" href="/img/favicon.ico" type="image/x-icon" />
  <link rel="apple-touch-icon" href="/img/apple-touch-icon.png" />

  
  <link href="/css/owl.carousel.css" rel="stylesheet">
  <link href="/css/owl.theme.css" rel="stylesheet">

  
  <link rel="alternate" href="http://www.continuousdelivery20.com/index.xml" type="application/rss+xml" title="持续交付 2.0">

  
  
  
  
  
  
  
  <meta property="og:locale" content="zh">
  <meta property="og:site_name" content="持续交付 2.0">
  <meta property="og:title" content="SRE落地：用VALET模式统一语言">
  <meta property="og:type" content="article">
  <meta property="og:url" content="http://www.continuousdelivery20.com/blog/sre-valet-model/" />
  <meta property="og:description" content="持续交付2.0 爱好者网站，本网站讨论持续交付，DevOps，敏捷开发，精益思想，Scrum，敏捷方法，用户故事">
  <meta property="og:image" content="http://www.continuousdelivery20.com/img/banners/sre-valet.jpg">
  <meta property="og:image:type" content="image/jpg">
  
  
  
    <meta property="og:image:width" content="1000">
    <meta property="og:image:height" content="667">
  
  
  <meta property="og:updated_time" content="2020-12-18T00:00:00Z">
  
    
    
    <meta property="article:section" content="实践案例">
    <meta property="article:tag" content="DevOps">
    <meta property="article:tag" content="SRE">
    
    
    <meta property="article:published_time" content="2020-12-18T00:00:00Z">
    <meta property="article:modified_time" content="2020-12-18T00:00:00Z">
  

  
  <meta name="twitter:card" content="summary_large_image">
  
  <meta name="twitter:title" content="SRE落地：用VALET模式统一语言">
  
  <meta name="twitter:image" content="http://www.continuousdelivery20.com/img/banners/sre-valet.jpg">
  
  <meta name="twitter:description" content="持续交付2.0 爱好者网站，本网站讨论持续交付，DevOps，敏捷开发，精益思想，Scrum，敏捷方法，用户故事">
  

</head>


  <body>

    <div id="all">

        <header>

          <div class="navbar-affixed-top" data-spy="affix" data-offset-top="200">

    <div class="navbar navbar-default yamm" role="navigation" id="navbar">

        <div class="container">
            <div class="navbar-header">
                <a class="navbar-brand home" href="/">
                    <img src="/img/logo.png" alt="SRE落地：用VALET模式统一语言 logo" class="hidden-xs hidden-sm">
                    <img src="/img/logo-small.png" alt="SRE落地：用VALET模式统一语言 logo" class="visible-xs visible-sm">
                    <span class="sr-only">SRE落地：用VALET模式统一语言 - 跳到主页</span>
                </a>
                <div class="navbar-buttons">
                    <button type="button" class="navbar-toggle btn-template-main" data-toggle="collapse" data-target="#navigation">
                      <span class="sr-only">切换导航</span>
                        <i class="fas fa-align-justify"></i>
                    </button>
                </div>
            </div>
            

            <div class="navbar-collapse collapse" id="navigation">
                <ul class="nav navbar-nav navbar-right">
                  
                  
                  
                  <li class="dropdown">
                    
                    <a href="/">主页</a>
                    
                  </li>
                  
                  
                  <li class="dropdown active">
                    
                    <a href="/blog/">博客</a>
                    
                  </li>
                  
                  
                  <li class="dropdown">
                    
                    <a href="/faq/">资源</a>
                    
                  </li>
                  
                  
                  <li class="dropdown">
                    
                    <a href="/contact/">关于</a>
                    
                  </li>
                  
                </ul>
            </div>
            

            <div class="collapse clearfix" id="search">

                <form class="navbar-form" role="search">
                    <div class="input-group">
                        <input type="text" class="form-control" placeholder="Search">
                        <span class="input-group-btn">

                    <button type="submit" class="btn btn-template-main"><i class="fas fa-search"></i></button>

                </span>
                    </div>
                </form>

            </div>
            

        </div>
    </div>
    

</div>




        </header>

        <div id="heading-breadcrumbs">
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <h1>SRE落地：用VALET模式统一语言</h1>
            </div>
        </div>
    </div>
</div>


        <div id="content">
            <div class="container">

                <div class="row">

                    

                    <div class="col-md-9" id="blog-post">

                        <p class="text-muted text-uppercase mb-small text-right">由 <a href="#">持续交付2.0</a> | 2020-12-18</p>

                        <div id="post-content">
                          <p>本文源自《SRE工作手册》英文版第三章，讲述的是家得宝（THD）公司在SRE转型中如何使用VALET。</p>
<p>VALET 是一个易记易用的模式语言，分别代表：</p>
<ul>
<li>Volume</li>
<li>Availability</li>
<li>Latency</li>
<li>Error</li>
<li>Ticket</li>
</ul>
<p>内容简介：</p>
<p>一、家得宝运维工作的原始状态
二、SRE改进步骤</p>
<ol>
<li>建立统一语言</li>
<li>自动数据收集</li>
<li>建设仪表盘</li>
<li>写入开发负责人的OKR</li>
<li>管理批处理任务的SLO</li>
</ol>
<p>正文如下：</p>
<p>家得宝（THD）是世界上最大的家居装饰零售商，在北美拥有2200多家商店，每个商店都拥有 35,000 多种独特产品(并在线提供了超过 150 万种产品。在其基础架构中，托管着各种软件应用程序，这些软件应用程序支持近 40 万名员工，每年处理超过 15 亿笔客户交易。这些商店与全球供应链和一个电子商务网站紧密集成，每年访问量超过 20 亿。</p>
<p>在其软件服务架构向微服务的迁移的过程中，也完成了全栈所有权的“自由和责任文化”的增强。它让开发人员可以在其需要时按需推送代码上线，并让其共同负责服务的技术运营。</p>
<p>为了达成这种共有制的工作模式，运维团队和开发团队需要统一沟通语言，以促进责任制，并跨越复杂性。这种语言就是：服务水平目标(SLO)。相互依赖的服务之间需要了解以下信息（这里假设 A服务 依赖 B服务），负责A服务的团队会问：</p>
<ul>
<li>B服务有多可靠？它是为三个 9 ，三个半 9 或四个 9 而构建的？</li>
<li>B服务有计划的停机时间吗？</li>
<li>对 B 服务的延迟上限，可以有什么样的预期？</li>
<li>B 能处理 A 服务 发送的多少请求量吗？如何处理过载？B 服务是否已逐步达到其SLO？</li>
</ul>
<p>如果每个服务都可以为这些问题提供透明且一致的答案，那么团队将对他们的依存关系有清晰的了解，从而可以更好地进行沟通，并提高团队之间的信任度和责任。</p>
<p>改进步骤如下：</p>
<h2 id="一原始的状态">一、原始的状态</h2>
<p>家得宝原来的监控工具和仪表板数量很多，并且是分散在各处的。服务出现中断时，有时候根本找不到根源。通常，最开始会从用户接入服务处进行故障排除，然后进行反向跟踪，直到发现问题为止，这会浪费无数小时。如果某个服务做了计划内停机，其他相关服务很可能不知道，只会感到惊讶。如果团队的服务水平目标是99.9%，然而，他们并不知道他们所依赖的服务是否可以为他们提供更好的服务水平，比如（四个9）。</p>
<p>这些脱节导致了软件开发和运营团队之间的困惑、失望与对立。</p>
<h2 id="二建立通用语言">二、建立通用语言</h2>
<p>建立一个通用语言对于让各方意见统一至关重要。家得宝希望保持此框架尽可能简单，以帮助更快地统一传播。经过仔细研究，发现了一些模式。每个服务都可能监控它的&quot;流量&rdquo;，&ldquo;等待时间&rdquo;，&ldquo;错误&quot;和&quot;利用率&quot;这四个指标，但不幸的是，所有指标的整体监控都不一致，名称不同或数据不足。</p>
<p>另外，生产环境最接近面向客户的指标是“支持工单数”。家得宝衡量应用程序的可靠性的主要（也是唯一的）方法是跟踪内部支持部门收到的支持电话数量。</p>
<p>所以，将 SLO 总结为 VALET：</p>
<ul>
<li>Volume 容量（流量）</li>
</ul>
<p>​       <em>我的服务可以处理多少业务量？</em></p>
<ul>
<li>Availability 可用性</li>
</ul>
<p>​      <em>我需要时可以启动服务吗？</em></p>
<ul>
<li>Latency 延迟</li>
</ul>
<p>​      <em>使用该服务时，服务是否快速响应？</em></p>
<ul>
<li>Error 错误</li>
</ul>
<p>​     <em>使用该服务时是否抛出了错误？</em></p>
<ul>
<li>Ticket 故障单</li>
</ul>
<p>​    <em>服务是否需要人工干预才能完成我的请求？</em></p>
<h2 id="三自动valet数据收集">三、自动VALET数据收集</h2>
<p>家得宝将SLO正式纳入THD对开发经理的年度绩效评估中。虽然每周大约有50个服务定期按其SLO进行捕获和报告，但开始的管理方法太土，这些指标临时存储在电子表格中。</p>
<h3 id="tps报告">TPS报告</h3>
<p>家得宝建立了一个框架来自动捕获已部署到云端环境的服务 VALET 数据，并称此框架为“TPS报告”，是家得宝用来进行容量和性能测试（每秒事务处理）的术语，很多管理者可能希望查看此数据。家得宝的网络服务前端生成的所有日志均被写入BigQuery中，以供TPS报告进行处理。最终，家得宝将其他各种监控系统的指标也纳入进来，例如 Stackdriver 的可用性探针。</p>
<p>TPS报告将这些数据转换为任何人都可以查询的每小时 VALET 指标。新创建的服务会自动注册到TPS报告中，因此可以立即查询。由于数据全部存储在BigQuery中，因此可以跨时间段有效地报告VALET指标。员工可以使用这些数据来构建各种自动报告和警报。最有趣的集成是一个聊天机器人，员工也可以直接在聊天平台中询问它，每个服务的VALET值是多少。例如，任何服务都可以显示最后一小时的VALET，VALET与前一周的对比，以及其它一些数据。</p>
<h3 id="valet服务">VALET服务</h3>
<p>然后，家得宝又创建一个 VALET 应用程序，以存储和报告 SLO 数据。由于 SLO 可以最好地用作趋势工具，因此该服务每天、每周和每月对 SLO 进行跟踪。请注意，我 SLO 是一种趋势分析工具，可用于错误预算，但未直接连接到监控系统。相反，家得宝仍旧有各种不同的监控平台，每个监控平台都有自己的报警。这些监控系统每天汇总其 SLO ，并发布到 VALET 服务以进行趋势分析。这种设置的缺点是，监控系统中设置的警报阈值未与 SLO 集成在一起。但是，可以根据需要灵活地更改监控系统。</p>
<p>TPS 报告是第一个与 VALET 服务集成的系统，到目前为止，家得宝的 VALET 与其各种本地应用程序平台（在 VALET 中注册的服务的一半以上）集成。</p>
<h3 id="valet-仪表板">VALET 仪表板</h3>
<p><img src="/img/blog/sre-valet.webp" alt=""></p>
<p>VALET 仪表板如上图所示，用于可视化和报告此数据，并且相对简单。它允许用户：</p>
<ul>
<li>
<p>注册新服务。这通常意味着将服务分配给一个或多个URL，这些URL可能已经收集了VALET数据。</p>
</li>
<li>
<p>为五个 VALET 类别中的任何一个设定 SLO 目标。</p>
</li>
<li>
<p>在每个 VALET 类别下添加新的指标类型。例如，一项服务可以跟踪 P99 的延迟，而另一项服务可以跟踪 P90 （或两者）的延迟。后端处理系统可以跟踪每天的交易量（一天创建的购买订单），而客户服务前端可以跟踪每秒的高峰交易。</p>
</li>
</ul>
<p>VALET 仪表板使用户可以立即报告许多服务的 SLO ，并以多种方式对数据进行切片和切块。例如，一个团队可以查看过去一周不满足 SLO 的所有服务的统计信息。寻求查看服务性能的团队可以查看所有服务及其所依赖服务的延迟。VALET 仪表板将数据存储在简单的Cloud SQL数据库中，开发人员使用流行的 BI 工具来构建报告。</p>
<p>这些报告成为开发人员采取新的最佳实践的基础：定期对其服务进行 SLO 审核(通常是每周或每月)。基于这些审查，开发人员可以创建操作项以将服务返回到其 SLO ，或者可以决定需要调整不切实际的 SLO。</p>
<h2 id="四将valet应用于批处理应用">四、将VALET应用于批处理应用</h2>
<p>当围绕 SLO 开发可靠的报告时，家得宝还发现，只要对 VALET 稍作调整，就可以用在批处理应用程序上，如下所示:</p>
<p>**容量：**处理的记录量</p>
<p>**可用性：**在一定时间内完成工作的频率(以百分比为单位)</p>
<p>**延迟：**作业运行所需的时间</p>
<p>**错误：**无法处理的记录</p>
<p>**故障单：**操作员必须手动修复数据并重新处理作业的次数</p>
<h2 id="五下一个待解决的组织问题如何与产品经理沟通slo">五、下一个待解决的组织问题——如何与产品经理沟通SLO</h2>
<p>尽管对技术人员来说， VALET 很直观，但是对于产品经理来说，这个概念并不是那么直观。如何以业务术语转换指标，并在产品和开发之间共享可见的目标(SLO！)可能是个挑战。一旦解决，这将减少在大公司中经常看到的对可靠性的错位期望。</p>

                        </div>
                        
                        

                    </div>
                    

                    

                    

                    <div class="col-md-3">

                        

                        

<div class="panel panel-default sidebar-menu">

    <div class="panel-heading">
      <h3 class="panel-title">搜索</h3>
    </div>

    <div class="panel-body">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" role="search">
            <div class="input-group">
                <input type="search" name="q" class="form-control" placeholder="搜索">
                <input type="hidden" name="sitesearch" value="http://www.continuousdelivery20.com/">
                <span class="input-group-btn">
                    <button type="submit" class="btn btn-template-main"><i class="fas fa-search"></i></button>
                </span>
            </div>
        </form>
    </div>
</div>







<div class="panel panel-default sidebar-menu">

    <div class="panel-heading">
        <h3 class="panel-title">分类</h3>
    </div>

    <div class="panel-body">
        <ul class="nav nav-pills nav-stacked">
            
            
            <li>
                <a href="/categories/%e5%ae%9e%e8%b7%b5%e6%a1%88%e4%be%8b">实践案例 (11)</a>
            </li>
            
            <li>
                <a href="/categories/%e8%a7%82%e7%82%b9">观点 (1)</a>
            </li>
            
        </ul>
    </div>

</div>








<div class="panel sidebar-menu">

    <div class="panel-heading">
        <h3 class="panel-title">标签</h3>
    </div>

    <div class="panel-body">
        <ul class="tag-cloud">
            
            
            <li>
                <a href="/tags/automation"><i class="fas fa-tags"></i> automation</a>
            </li>
            
            <li>
                <a href="/tags/devops"><i class="fas fa-tags"></i> devops</a>
            </li>
            
            <li>
                <a href="/tags/microsoft"><i class="fas fa-tags"></i> microsoft</a>
            </li>
            
            <li>
                <a href="/tags/sre"><i class="fas fa-tags"></i> sre</a>
            </li>
            
            <li>
                <a href="/tags/test-in-production"><i class="fas fa-tags"></i> test-in-production</a>
            </li>
            
            <li>
                <a href="/tags/unit-test"><i class="fas fa-tags"></i> unit-test</a>
            </li>
            
            <li>
                <a href="/tags/%e5%8d%95%e5%85%83%e6%b5%8b%e8%af%95"><i class="fas fa-tags"></i> 单元测试</a>
            </li>
            
            <li>
                <a href="/tags/%e5%ae%89%e5%85%a8"><i class="fas fa-tags"></i> 安全</a>
            </li>
            
            <li>
                <a href="/tags/%e5%b7%a5%e7%a8%8b%e6%95%88%e8%83%bd"><i class="fas fa-tags"></i> 工程效能</a>
            </li>
            
            <li>
                <a href="/tags/%e5%be%ae%e8%bd%af"><i class="fas fa-tags"></i> 微软</a>
            </li>
            
            <li>
                <a href="/tags/%e6%8a%80%e6%9c%af%e7%ae%a1%e7%90%86"><i class="fas fa-tags"></i> 技术管理</a>
            </li>
            
            <li>
                <a href="/tags/%e6%8c%81%e7%bb%ad%e9%83%a8%e7%bd%b2"><i class="fas fa-tags"></i> 持续部署</a>
            </li>
            
            <li>
                <a href="/tags/%e6%96%b9%e6%b3%95"><i class="fas fa-tags"></i> 方法</a>
            </li>
            
            <li>
                <a href="/tags/%e6%a1%88%e4%be%8b"><i class="fas fa-tags"></i> 案例</a>
            </li>
            
            <li>
                <a href="/tags/%e6%b5%8b%e8%af%95%e5%8f%b3%e7%a7%bb"><i class="fas fa-tags"></i> 测试右移</a>
            </li>
            
            <li>
                <a href="/tags/%e6%b5%8b%e8%af%95%e5%b7%a6%e7%a7%bb"><i class="fas fa-tags"></i> 测试左移</a>
            </li>
            
            <li>
                <a href="/tags/%e7%bb%84%e7%bb%87%e8%bd%ac%e5%9e%8b"><i class="fas fa-tags"></i> 组织转型</a>
            </li>
            
            <li>
                <a href="/tags/%e8%87%aa%e5%8a%a8%e5%8c%96%e6%b5%8b%e8%af%95"><i class="fas fa-tags"></i> 自动化测试</a>
            </li>
            
        </ul>
    </div>

</div>






                        

                    </div>
                    

                    

                </div>
                

            </div>
            
        </div>
        

        <footer id="footer">
    <div class="container">

        
        <div class="col-md-4 col-sm-6">
            <h4>关于我们</h4>

            <p></p>

            <hr class="hidden-md hidden-lg hidden-sm">

        </div>
        
        

        <div class="col-md-4 col-sm-6">

             
            <h4>最新博客</h4>

            <div class="blog-entries">
                
                <div class="item same-height-row clearfix">
                    <div class="image same-height-always">
                        <a href="http://www.continuousdelivery20.com/blog/maximizing-developer-effectiveness/">
                          
                            <img src="/img/banners/effectiveness.png" class="img-responsive" alt="最大化开发人员的效率">
                          
                        </a>
                    </div>
                    <div class="name same-height-always">
                        <h5><a href="http://www.continuousdelivery20.com/blog/maximizing-developer-effectiveness/">最大化开发人员的效率</a></h5>
                    </div>
                </div>
                
                <div class="item same-height-row clearfix">
                    <div class="image same-height-always">
                        <a href="http://www.continuousdelivery20.com/blog/sre-valet-model/">
                          
                            <img src="/img/banners/sre-valet.jpg" class="img-responsive" alt="SRE落地：用VALET模式统一语言">
                          
                        </a>
                    </div>
                    <div class="name same-height-always">
                        <h5><a href="http://www.continuousdelivery20.com/blog/sre-valet-model/">SRE落地：用VALET模式统一语言</a></h5>
                    </div>
                </div>
                
                <div class="item same-height-row clearfix">
                    <div class="image same-height-always">
                        <a href="http://www.continuousdelivery20.com/blog/ms-test-transformation/">
                          
                            <img src="/img/banners/ms-ceo.jpg" class="img-responsive" alt="微软测试转型的历程与心法(5000字长文)">
                          
                        </a>
                    </div>
                    <div class="name same-height-always">
                        <h5><a href="http://www.continuousdelivery20.com/blog/ms-test-transformation/">微软测试转型的历程与心法(5000字长文)</a></h5>
                    </div>
                </div>
                
            </div>

            <hr class="hidden-md hidden-lg">
             

        </div>
        

        
        <div class="col-md-4 col-sm-6">

          <h4>联系</h4>

            <p class="text-uppercase"><strong>《持续交付2.0》爱好者社区</strong>
        <br>北京国际饭店 5层
        <br>东城区
        <br>北京市
        <br>
        <strong>中国</strong>
      </p>
      

            <a href="/contact" class="btn btn-small btn-template-main">跳到联系页面</a>

            <hr class="hidden-md hidden-lg hidden-sm">

        </div>
        
        

    </div>
    
</footer>







<div id="copyright">
    <div class="container">
        <div class="col-md-12">
            
            <p class="pull-left">Copyright ©️ 2019 - 2028, 《持续交付2.0》作者 乔梁; all rights reserved.  <a href='https://beian.miit.gov.cn/'>京ICP备18046893号-1</a></p>
            
            <p class="pull-right">
              模板来自 <a href="https://bootstrapious.com/p/universal-business-e-commerce-template">Bootstrapious</a>.
              

              移植到 Hugo 来自 <a href="https://github.com/devcows/hugo-universal-theme">DevCows</a>.
            </p>
        </div>
    </div>
</div>





    </div>
    

    
<script src="//code.jquery.com/jquery-3.1.1.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>
<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<script src="//cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/waypoints/4.0.1/jquery.waypoints.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/Counter-Up/1.0/jquery.counterup.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/jquery-parallax/1.1.3/jquery-parallax.js"></script>

<script src="//maps.googleapis.com/maps/api/js?v=3.exp"></script>

<script src="/js/hpneo.gmaps.js"></script>
<script src="/js/gmaps.init.js"></script>
<script src="/js/front.js"></script>


<script src="/js/owl.carousel.min.js"></script>



  </body>
</html>
